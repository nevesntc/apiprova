<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/frontend/src/features/catalogo/pages/CatalogoPage.jsx">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/frontend/src/features/catalogo/pages/CatalogoPage.jsx" />
              <option name="originalContent" value="import React, { useEffect, useState } from 'react'&#10;import { listarCategorias, listarProdutos } from '@/features/catalogo/services/api'&#10;import { parseJwt, clearToken, getToken } from '@/features/catalogo/services/api'&#10;import FormNovoProduto from '@/features/catalogo/components/FormNovoProduto'&#10;import LoginModal from '@/features/catalogo/components/LoginModal'&#10;&#10;export default function CatalogoPage() {&#10;  const [dados, setDados] = useState([])&#10;  const [produtos, setProdutos] = useState([])&#10;  const [loading, setLoading] = useState(true)&#10;  const [erro, setErro] = useState(null)&#10;  const [retryFlag, setRetryFlag] = useState(0)&#10;  const [loginOpen, setLoginOpen] = useState(false)&#10;  const [tokenInfo, setTokenInfo] = useState(() =&gt; parseJwt(getToken()))&#10;&#10;  useEffect(() =&gt; {&#10;    function onUnauth(){ setLoginOpen(true) }&#10;    window.addEventListener('vass:unauth', onUnauth)&#10;    return ()=&gt; window.removeEventListener('vass:unauth', onUnauth)&#10;  }, [])&#10;&#10;  useEffect(() =&gt; {&#10;    const token = getToken()&#10;    if (!token) {&#10;      // don't call protected endpoints without a token; prompt login instead&#10;      setLoading(false)&#10;      setLoginOpen(true)&#10;      return&#10;    }&#10;    const ac = new AbortController()&#10;    setLoading(true); setErro(null)&#10;    Promise.all([listarCategorias(ac.signal), listarProdutos()])&#10;      .then(([cats, prods]) =&gt; { setDados(cats); setProdutos(prods) })&#10;      .catch(e =&gt; { if (e.name !== 'AbortError') setErro(e.message) })&#10;      .finally(() =&gt; setLoading(false))&#10;    return () =&gt; ac.abort()&#10;  }, [retryFlag])&#10;&#10;  function handleLogin(token) {&#10;    setTokenInfo(parseJwt(token))&#10;    setRetryFlag(f =&gt; f + 1)&#10;  }&#10;&#10;  function handleLogout() {&#10;    clearToken()&#10;    setTokenInfo(null)&#10;    setRetryFlag(f =&gt; f + 1)&#10;  }&#10;&#10;  function tentarNovamente() { setRetryFlag(f =&gt; f + 1) }&#10;&#10;  if (loading) return &lt;p className=&quot;small&quot;&gt;Carregando...&lt;/p&gt;&#10;  if (erro) return &lt;div className=&quot;card&quot;&gt;&lt;p style={{color:'crimson'}}&gt;Erro: {erro}&lt;/p&gt;&lt;button onClick={tentarNovamente} className=&quot;btn&quot;&gt;Tentar novamente&lt;/button&gt;&lt;/div&gt;&#10;&#10;  return (&#10;    &lt;div className=&quot;main-container&quot;&gt;&#10;      &lt;header className=&quot;header&quot;&gt;&#10;        &lt;div className=&quot;brand&quot;&gt;&#10;          &lt;svg width=&quot;36&quot; height=&quot;36&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;&lt;rect width=&quot;24&quot; height=&quot;24&quot; rx=&quot;6&quot; fill=&quot;#0ea5e9&quot;/&gt;&lt;path d=&quot;M7 12h10M7 8h10M7 16h6&quot; stroke=&quot;#fff&quot; strokeWidth=&quot;1.5&quot; strokeLinecap=&quot;round&quot; strokeLinejoin=&quot;round&quot;/&gt;&lt;/svg&gt;&#10;          &lt;h1&gt;VassCommerce&lt;/h1&gt;&#10;          &lt;div className=&quot;small&quot;&gt;Catálogo&lt;/div&gt;&#10;        &lt;/div&gt;&#10;        &lt;div className=&quot;controls&quot;&gt;&#10;          {tokenInfo ? (&#10;            &lt;div style={{display:'flex',gap:12,alignItems:'center'}}&gt;&#10;              &lt;div style={{textAlign:'right'}}&gt;&#10;                &lt;div className=&quot;small&quot;&gt;{tokenInfo.sub}&lt;/div&gt;&#10;                &lt;div className=&quot;small&quot; title={tokenInfo.roles}&gt;{(tokenInfo.roles || '').split(',').join(', ')}&lt;/div&gt;&#10;                &lt;div className=&quot;small&quot;&gt;exp: {tokenInfo.exp ? new Date(tokenInfo.exp*1000).toLocaleString() : '-'}&lt;/div&gt;&#10;              &lt;/div&gt;&#10;              &lt;button className=&quot;btn&quot; onClick={handleLogout} style={{background:'#ef4444'}}&gt;Sair&lt;/button&gt;&#10;            &lt;/div&gt;&#10;          ) : (&#10;            &lt;div style={{display:'flex',gap:8}}&gt;&#10;              &lt;button className=&quot;btn&quot; onClick={()=&gt;setLoginOpen(true)}&gt;Entrar&lt;/button&gt;&#10;            &lt;/div&gt;&#10;          )}&#10;        &lt;/div&gt;&#10;       &lt;/header&gt;&#10;&#10;      &lt;LoginModal open={loginOpen} onClose={()=&gt;setLoginOpen(false)} onLogin={handleLogin} /&gt;&#10;&#10;      &lt;div className=&quot;content&quot;&gt;&#10;        &lt;section&gt;&#10;          &lt;div className=&quot;card&quot;&gt;&#10;            &lt;h3 style={{marginTop:0}}&gt;Categorias&lt;/h3&gt;&#10;            &lt;div className=&quot;categories-grid&quot;&gt;&#10;              {dados.map(c =&gt; (&#10;                &lt;div className=&quot;category&quot; key={c.id}&gt;&#10;                  &lt;h4&gt;{c.nome}&lt;/h4&gt;&#10;                  &lt;p&gt;{c.descricao || '—'}&lt;/p&gt;&#10;                &lt;/div&gt;&#10;              ))}&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;&#10;          &lt;div style={{height:16}} /&gt;&#10;&#10;          &lt;div className=&quot;card&quot;&gt;&#10;            &lt;h3 style={{marginTop:0}}&gt;Produtos&lt;/h3&gt;&#10;            {produtos.length === 0 ? &lt;p className=&quot;small&quot;&gt;Nenhum produto&lt;/p&gt; : (&#10;              &lt;div style={{display:'grid',gap:8}}&gt;&#10;                {produtos.map(p =&gt; (&#10;                  &lt;div key={p.id} className=&quot;category&quot;&gt;&#10;                    &lt;strong&gt;{p.nome}&lt;/strong&gt;&#10;                    &lt;div className=&quot;small&quot;&gt;R$ {p.valor?.toFixed(2)} • Categoria {p.categoriaId}&lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            )}&#10;          &lt;/div&gt;&#10;        &lt;/section&gt;&#10;&#10;        &lt;aside&gt;&#10;          &lt;div className=&quot;card&quot;&gt;&#10;            &lt;h3 style={{marginTop:0}}&gt;Novo Produto&lt;/h3&gt;&#10;            &lt;FormNovoProduto onCriado={() =&gt; { alert('Produto criado!'); setRetryFlag(f=&gt;f+1) }} /&gt;&#10;            &lt;p className=&quot;small&quot; style={{marginTop:8}}&gt;Use um ID de categoria existente (ex.: 1).&lt;/p&gt;&#10;          &lt;/div&gt;&#10;        &lt;/aside&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  )&#10;}&#10;" />
              <option name="updatedContent" value="import React, { useEffect, useState } from 'react'&#10;import { listarCategorias, listarProdutos } from '@/features/catalogo/services/api'&#10;import { parseJwt, clearToken, getToken } from '@/features/catalogo/services/api'&#10;import FormNovoProduto from '@/features/catalogo/components/FormNovoProduto'&#10;import AuthModal from '@/features/catalogo/components/LoginModal'&#10;&#10;export default function CatalogoPage() {&#10;  const [dados, setDados] = useState([])&#10;  const [produtos, setProdutos] = useState([])&#10;  const [loading, setLoading] = useState(true)&#10;  const [erro, setErro] = useState(null)&#10;  const [retryFlag, setRetryFlag] = useState(0)&#10;  const [loginOpen, setLoginOpen] = useState(false)&#10;  const [tokenInfo, setTokenInfo] = useState(() =&gt; parseJwt(getToken()))&#10;&#10;  useEffect(() =&gt; {&#10;    function onUnauth(){ setLoginOpen(true) }&#10;    window.addEventListener('vass:unauth', onUnauth)&#10;    return ()=&gt; window.removeEventListener('vass:unauth', onUnauth)&#10;  }, [])&#10;&#10;  useEffect(() =&gt; {&#10;    const token = getToken()&#10;    if (!token) {&#10;      // don't call protected endpoints without a token; prompt login instead&#10;      setLoading(false)&#10;      setLoginOpen(true)&#10;      return&#10;    }&#10;    const ac = new AbortController()&#10;    setLoading(true); setErro(null)&#10;    Promise.all([listarCategorias(ac.signal), listarProdutos()])&#10;      .then(([cats, prods]) =&gt; { setDados(cats); setProdutos(prods) })&#10;      .catch(e =&gt; { if (e.name !== 'AbortError') setErro(e.message) })&#10;      .finally(() =&gt; setLoading(false))&#10;    return () =&gt; ac.abort()&#10;  }, [retryFlag])&#10;&#10;  function handleLogin(token) {&#10;    setTokenInfo(parseJwt(token))&#10;    setRetryFlag(f =&gt; f + 1)&#10;  }&#10;&#10;  function handleLogout() {&#10;    clearToken()&#10;    setTokenInfo(null)&#10;    setRetryFlag(f =&gt; f + 1)&#10;  }&#10;&#10;  function tentarNovamente() { setRetryFlag(f =&gt; f + 1) }&#10;&#10;  if (loading) return &lt;p className=&quot;small&quot;&gt;Carregando...&lt;/p&gt;&#10;  if (erro) return &lt;div className=&quot;card&quot;&gt;&lt;p style={{color:'crimson'}}&gt;Erro: {erro}&lt;/p&gt;&lt;button onClick={tentarNovamente} className=&quot;btn&quot;&gt;Tentar novamente&lt;/button&gt;&lt;/div&gt;&#10;&#10;  return (&#10;    &lt;div className=&quot;main-container&quot;&gt;&#10;      &lt;header className=&quot;header&quot;&gt;&#10;        &lt;div className=&quot;brand&quot;&gt;&#10;          &lt;svg width=&quot;36&quot; height=&quot;36&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;&lt;rect width=&quot;24&quot; height=&quot;24&quot; rx=&quot;6&quot; fill=&quot;#0ea5e9&quot;/&gt;&lt;path d=&quot;M7 12h10M7 8h10M7 16h6&quot; stroke=&quot;#fff&quot; strokeWidth=&quot;1.5&quot; strokeLinecap=&quot;round&quot; strokeLinejoin=&quot;round&quot;/&gt;&lt;/svg&gt;&#10;          &lt;h1&gt;VassCommerce&lt;/h1&gt;&#10;          &lt;div className=&quot;small&quot;&gt;Catálogo&lt;/div&gt;&#10;        &lt;/div&gt;&#10;        &lt;div className=&quot;controls&quot;&gt;&#10;          {tokenInfo ? (&#10;            &lt;div style={{display:'flex',gap:12,alignItems:'center'}}&gt;&#10;              &lt;div style={{textAlign:'right'}}&gt;&#10;                &lt;div className=&quot;small&quot;&gt;{tokenInfo.sub}&lt;/div&gt;&#10;                &lt;div className=&quot;small&quot; title={tokenInfo.roles}&gt;{(tokenInfo.roles || '').split(',').join(', ')}&lt;/div&gt;&#10;                &lt;div className=&quot;small&quot;&gt;exp: {tokenInfo.exp ? new Date(tokenInfo.exp*1000).toLocaleString() : '-'}&lt;/div&gt;&#10;              &lt;/div&gt;&#10;              &lt;button className=&quot;btn&quot; onClick={handleLogout} style={{background:'#ef4444'}}&gt;Sair&lt;/button&gt;&#10;            &lt;/div&gt;&#10;          ) : (&#10;            &lt;div style={{display:'flex',gap:8}}&gt;&#10;              &lt;button className=&quot;btn&quot; onClick={()=&gt;setLoginOpen(true)}&gt;Entrar&lt;/button&gt;&#10;            &lt;/div&gt;&#10;          )}&#10;        &lt;/div&gt;&#10;       &lt;/header&gt;&#10;&#10;      &lt;AuthModal open={loginOpen} onClose={()=&gt;setLoginOpen(false)} onLogin={handleLogin} /&gt;&#10;&#10;      &lt;div className=&quot;content&quot;&gt;&#10;        &lt;section&gt;&#10;          &lt;div className=&quot;card&quot;&gt;&#10;            &lt;h3 style={{marginTop:0}}&gt;Categorias&lt;/h3&gt;&#10;            &lt;div className=&quot;categories-grid&quot;&gt;&#10;              {dados.map(c =&gt; (&#10;                &lt;div className=&quot;category&quot; key={c.id}&gt;&#10;                  &lt;h4&gt;{c.nome}&lt;/h4&gt;&#10;                  &lt;p&gt;{c.descricao || '—'}&lt;/p&gt;&#10;                &lt;/div&gt;&#10;              ))}&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;&#10;          &lt;div style={{height:16}} /&gt;&#10;&#10;          &lt;div className=&quot;card&quot;&gt;&#10;            &lt;h3 style={{marginTop:0}}&gt;Produtos&lt;/h3&gt;&#10;            {produtos.length === 0 ? &lt;p className=&quot;small&quot;&gt;Nenhum produto&lt;/p&gt; : (&#10;              &lt;div style={{display:'grid',gap:8}}&gt;&#10;                {produtos.map(p =&gt; (&#10;                  &lt;div key={p.id} className=&quot;category&quot;&gt;&#10;                    &lt;strong&gt;{p.nome}&lt;/strong&gt;&#10;                    &lt;div className=&quot;small&quot;&gt;R$ {p.valor?.toFixed(2)} • Categoria {p.categoriaId}&lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            )}&#10;          &lt;/div&gt;&#10;        &lt;/section&gt;&#10;&#10;        &lt;aside&gt;&#10;          &lt;div className=&quot;card&quot;&gt;&#10;            &lt;h3 style={{marginTop:0}}&gt;Novo Produto&lt;/h3&gt;&#10;            &lt;FormNovoProduto onCriado={() =&gt; { alert('Produto criado!'); setRetryFlag(f=&gt;f+1) }} /&gt;&#10;            &lt;p className=&quot;small&quot; style={{marginTop:8}}&gt;Use um ID de categoria existente (ex.: 1).&lt;/p&gt;&#10;          &lt;/div&gt;&#10;        &lt;/aside&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  )&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/frontend/vite.config.js">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/frontend/vite.config.js" />
              <option name="originalContent" value="import { defineConfig } from 'vite'&#10;import react from '@vitejs/plugin-react'&#10;&#10;export default defineConfig({&#10;  plugins: [react()],&#10;  server: {&#10;    port: 5173,&#10;    proxy: {&#10;      '/api': {&#10;        target: 'http://localhost:8080',&#10;        changeOrigin: true&#10;      }&#10;    }&#10;  },&#10;  resolve: {&#10;    alias: {&#10;      '@': '/src'&#10;    }&#10;  }&#10;})&#10;&#10;" />
              <option name="updatedContent" value="import { defineConfig } from 'vite'&#13;&#10;import react from '@vitejs/plugin-react'&#13;&#10;&#13;&#10;export default defineConfig({&#13;&#10;  plugins: [react()],&#13;&#10;  server: {&#10;    port: 5173,&#10;    proxy: {&#10;      '/api': {&#10;        target: 'http://localhost:8080',&#10;        changeOrigin: true&#10;      },&#10;      '/auth': {&#10;        target: 'http://localhost:8080',&#10;        changeOrigin: true&#10;      }&#10;    }&#10;  },&#13;&#10;  resolve: {&#13;&#10;    alias: {&#13;&#10;      '@': '/src'&#13;&#10;    }&#13;&#10;  }&#13;&#10;})&#13;&#10;&#13;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/br/com/neves/vassourasecommerce/controller/AuthController.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/br/com/neves/vassourasecommerce/controller/AuthController.java" />
              <option name="originalContent" value="package br.com.neves.vassourasecommerce.controller;&#10;&#10;import br.com.neves.vassourasecommerce.security.JwtService;&#10;import org.springframework.http.ResponseEntity;&#10;import org.springframework.security.authentication.AuthenticationManager;&#10;import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;&#10;import org.springframework.security.core.Authentication;&#10;import org.springframework.security.core.GrantedAuthority;&#10;import org.springframework.web.bind.annotation.*;&#10;&#10;import java.util.List;&#10;import java.util.stream.Collectors;&#10;&#10;@RestController&#10;@RequestMapping(&quot;/auth&quot;)&#10;public class AuthController {&#10;&#10;    private final AuthenticationManager authManager;&#10;    private final JwtService jwtService;&#10;&#10;    public AuthController(AuthenticationManager authManager, JwtService jwtService) {&#10;        this.authManager = authManager;&#10;        this.jwtService = jwtService;&#10;    }&#10;&#10;    record LoginRequest(String username, String password) {}&#10;    record TokenResponse(String token) {}&#10;&#10;    @PostMapping(path = &quot;/login&quot;, consumes = &quot;application/json&quot;, produces = &quot;application/json&quot;)&#10;    public ResponseEntity&lt;TokenResponse&gt; login(@RequestBody LoginRequest req) {&#10;        Authentication a = authManager.authenticate(new UsernamePasswordAuthenticationToken(req.username(), req.password()));&#10;        List&lt;String&gt; roles = a.getAuthorities().stream().map(GrantedAuthority::getAuthority).collect(Collectors.toList());&#10;        String token = jwtService.generateToken(a.getName(), roles);&#10;        return ResponseEntity.ok(new TokenResponse(token));&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package br.com.neves.vassourasecommerce.controller;&#13;&#10;&#13;&#10;import br.com.neves.vassourasecommerce.security.JwtService;&#13;&#10;import org.springframework.http.ResponseEntity;&#13;&#10;import org.springframework.security.authentication.AuthenticationManager;&#13;&#10;import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;&#13;&#10;import org.springframework.security.core.Authentication;&#13;&#10;import org.springframework.security.core.GrantedAuthority;&#13;&#10;import org.springframework.web.bind.annotation.*;&#13;&#10;&#13;&#10;import java.util.List;&#13;&#10;import java.util.stream.Collectors;&#13;&#10;&#13;&#10;@RestController&#13;&#10;@RequestMapping(&quot;/auth&quot;)&#13;&#10;public class AuthController {&#13;&#10;&#13;&#10;    private final AuthenticationManager authManager;&#13;&#10;    private final JwtService jwtService;&#13;&#10;    private final org.springframework.security.provisioning.UserDetailsManager userDetailsManager;&#13;&#10;    private final org.springframework.security.crypto.password.PasswordEncoder passwordEncoder;&#13;&#10;&#13;&#10;    public AuthController(AuthenticationManager authManager, JwtService jwtService,&#13;&#10;                          org.springframework.security.provisioning.UserDetailsManager userDetailsManager,&#13;&#10;                          org.springframework.security.crypto.password.PasswordEncoder passwordEncoder) {&#13;&#10;        this.authManager = authManager;&#13;&#10;        this.jwtService = jwtService;&#13;&#10;        this.userDetailsManager = userDetailsManager;&#13;&#10;        this.passwordEncoder = passwordEncoder;&#13;&#10;    }&#13;&#10;&#13;&#10;    record LoginRequest(String username, String password) {}&#13;&#10;    record TokenResponse(String token) {}&#13;&#10;    record RegisterRequest(String username, String password) {}&#13;&#10;    record MessageResponse(String message) {}&#13;&#10;&#13;&#10;    @PostMapping(path = &quot;/login&quot;, consumes = &quot;application/json&quot;, produces = &quot;application/json&quot;)&#13;&#10;    public ResponseEntity&lt;TokenResponse&gt; login(@RequestBody LoginRequest req) {&#13;&#10;        Authentication a = authManager.authenticate(new UsernamePasswordAuthenticationToken(req.username(), req.password()));&#13;&#10;        List&lt;String&gt; roles = a.getAuthorities().stream().map(GrantedAuthority::getAuthority).collect(Collectors.toList());&#13;&#10;        String token = jwtService.generateToken(a.getName(), roles);&#13;&#10;        return ResponseEntity.ok(new TokenResponse(token));&#13;&#10;    }&#13;&#10;&#13;&#10;    @PostMapping(path = &quot;/register&quot;, consumes = &quot;application/json&quot;, produces = &quot;application/json&quot;)&#13;&#10;    public ResponseEntity&lt;MessageResponse&gt; register(@RequestBody RegisterRequest req) {&#13;&#10;        if (userDetailsManager.userExists(req.username())) {&#13;&#10;            return ResponseEntity.status(400).body(new MessageResponse(&quot;Usuário já existe&quot;));&#13;&#10;        }&#13;&#10;        org.springframework.security.core.userdetails.User newUser =&#13;&#10;            (org.springframework.security.core.userdetails.User) org.springframework.security.core.userdetails.User&#13;&#10;                .withUsername(req.username())&#13;&#10;                .password(passwordEncoder.encode(req.password()))&#13;&#10;                .roles(&quot;USER&quot;)&#13;&#10;                .build();&#13;&#10;        userDetailsManager.createUser(newUser);&#13;&#10;        return ResponseEntity.status(201).body(new MessageResponse(&quot;Usuário criado com sucesso&quot;));&#13;&#10;    }&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/br/com/neves/vassourasecommerce/security/SecurityConfig.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/br/com/neves/vassourasecommerce/security/SecurityConfig.java" />
              <option name="originalContent" value="package br.com.neves.vassourasecommerce.security;&#10;&#10;import jakarta.servlet.http.HttpServletResponse;&#10;import org.springframework.context.annotation.Bean;&#10;import org.springframework.context.annotation.Configuration;&#10;import org.springframework.http.HttpMethod;&#10;import org.springframework.security.authentication.AuthenticationManager;&#10;import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;&#10;import org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;&#10;import org.springframework.security.config.annotation.web.builders.HttpSecurity;&#10;import org.springframework.security.config.http.SessionCreationPolicy;&#10;import org.springframework.security.core.userdetails.User;&#10;import org.springframework.security.core.userdetails.UserDetailsService;&#10;import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;&#10;import org.springframework.security.crypto.password.PasswordEncoder;&#10;import org.springframework.security.provisioning.InMemoryUserDetailsManager;&#10;import org.springframework.security.web.AuthenticationEntryPoint;&#10;import org.springframework.security.web.SecurityFilterChain;&#10;import org.springframework.security.web.access.AccessDeniedHandler;&#10;import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;&#10;&#10;import java.util.List;&#10;&#10;@Configuration&#10;@EnableMethodSecurity&#10;public class SecurityConfig {&#10;&#10;    @Bean&#10;    public PasswordEncoder passwordEncoder() {&#10;        return new BCryptPasswordEncoder();&#10;    }&#10;&#10;    @Bean&#10;    public UserDetailsService userDetailsService(PasswordEncoder pe) {&#10;        InMemoryUserDetailsManager mgr = new InMemoryUserDetailsManager();&#10;        mgr.createUser(User.withUsername(&quot;admin&quot;).password(pe.encode(&quot;123456&quot;)).roles(&quot;ADMIN&quot;).build());&#10;        mgr.createUser(User.withUsername(&quot;user&quot;).password(pe.encode(&quot;654321&quot;)).roles(&quot;USER&quot;).build());&#10;        return mgr;&#10;    }&#10;&#10;    @Bean&#10;    public AuthenticationEntryPoint authenticationEntryPoint() {&#10;        return (request, response, authException) -&gt; {&#10;            response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);&#10;            response.setContentType(&quot;application/json&quot;);&#10;            response.getWriter().write(&quot;{\&quot;error\&quot;:\&quot;Unauthorized\&quot;}&quot;);&#10;        };&#10;    }&#10;&#10;    @Bean&#10;    public AccessDeniedHandler accessDeniedHandler() {&#10;        return (request, response, accessDeniedException) -&gt; {&#10;            response.setStatus(HttpServletResponse.SC_FORBIDDEN);&#10;            response.setContentType(&quot;application/json&quot;);&#10;            response.getWriter().write(&quot;{\&quot;error\&quot;:\&quot;Forbidden\&quot;}&quot;);&#10;        };&#10;    }&#10;&#10;    @Bean&#10;    public SecurityFilterChain securityFilterChain(HttpSecurity http, JwtAuthFilter jwtAuthFilter) throws Exception {&#10;        http&#10;                .csrf().disable()&#10;                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)&#10;                .and()&#10;                .exceptionHandling().authenticationEntryPoint(authenticationEntryPoint()).accessDeniedHandler(accessDeniedHandler())&#10;                .and()&#10;                .authorizeHttpRequests(authorize -&gt; authorize&#10;                        .requestMatchers(HttpMethod.POST, &quot;/auth/login&quot;).permitAll()&#10;                        .requestMatchers(HttpMethod.GET, &quot;/produto&quot;).hasAnyRole(&quot;USER&quot;,&quot;ADMIN&quot;)&#10;                        .requestMatchers(HttpMethod.POST, &quot;/produto&quot;).hasRole(&quot;ADMIN&quot;)&#10;                        .requestMatchers(HttpMethod.DELETE, &quot;/produto/**&quot;).hasRole(&quot;ADMIN&quot;)&#10;                        .requestMatchers(HttpMethod.GET, &quot;/categoria&quot;).hasAnyRole(&quot;USER&quot;,&quot;ADMIN&quot;)&#10;                        .requestMatchers(&quot;/admin/**&quot;).hasRole(&quot;ADMIN&quot;)&#10;                        .anyRequest().authenticated()&#10;                )&#10;                .addFilterBefore(jwtAuthFilter, UsernamePasswordAuthenticationFilter.class);&#10;        return http.build();&#10;    }&#10;&#10;    @Bean&#10;    public AuthenticationManager authenticationManager(HttpSecurity http, UserDetailsService uds, PasswordEncoder pe) throws Exception {&#10;        AuthenticationManagerBuilder auth = http.getSharedObject(AuthenticationManagerBuilder.class);&#10;        auth.userDetailsService(uds).passwordEncoder(pe);&#10;        return auth.build();&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package br.com.neves.vassourasecommerce.security;&#10;&#10;import jakarta.servlet.http.HttpServletResponse;&#10;import org.springframework.context.annotation.Bean;&#10;import org.springframework.context.annotation.Configuration;&#10;import org.springframework.http.HttpMethod;&#10;import org.springframework.security.authentication.AuthenticationManager;&#10;import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;&#10;import org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;&#10;import org.springframework.security.config.annotation.web.builders.HttpSecurity;&#10;import org.springframework.security.config.http.SessionCreationPolicy;&#10;import org.springframework.security.core.userdetails.User;&#10;import org.springframework.security.core.userdetails.UserDetailsService;&#10;import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;&#10;import org.springframework.security.crypto.password.PasswordEncoder;&#10;import org.springframework.security.provisioning.InMemoryUserDetailsManager;&#10;import org.springframework.security.web.AuthenticationEntryPoint;&#10;import org.springframework.security.web.SecurityFilterChain;&#10;import org.springframework.security.web.access.AccessDeniedHandler;&#10;import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;&#10;import org.springframework.web.cors.CorsConfiguration;&#10;import org.springframework.web.cors.CorsConfigurationSource;&#10;import org.springframework.web.cors.UrlBasedCorsConfigurationSource;&#10;&#10;import java.util.Arrays;&#10;import java.util.List;&#10;&#10;@Configuration&#10;@EnableMethodSecurity&#10;public class SecurityConfig {&#10;&#10;    @Bean&#10;    public PasswordEncoder passwordEncoder() {&#10;        return new BCryptPasswordEncoder();&#10;    }&#10;&#10;    @Bean&#10;    public CorsConfigurationSource corsConfigurationSource() {&#10;        CorsConfiguration configuration = new CorsConfiguration();&#10;        configuration.setAllowedOrigins(Arrays.asList(&quot;http://localhost:5173&quot;, &quot;http://localhost:5174&quot;));&#10;        configuration.setAllowedMethods(Arrays.asList(&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;, &quot;OPTIONS&quot;));&#10;        configuration.setAllowedHeaders(Arrays.asList(&quot;*&quot;));&#10;        configuration.setAllowCredentials(true);&#10;        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();&#10;        source.registerCorsConfiguration(&quot;/**&quot;, configuration);&#10;        return source;&#10;    }&#10;&#10;    @Bean&#10;    public UserDetailsService userDetailsService(PasswordEncoder pe) {&#10;        InMemoryUserDetailsManager mgr = new InMemoryUserDetailsManager();&#10;        mgr.createUser(User.withUsername(&quot;admin&quot;).password(pe.encode(&quot;123456&quot;)).roles(&quot;ADMIN&quot;).build());&#10;        mgr.createUser(User.withUsername(&quot;user&quot;).password(pe.encode(&quot;654321&quot;)).roles(&quot;USER&quot;).build());&#10;        return mgr;&#10;    }&#10;&#10;    @Bean&#10;    public AuthenticationEntryPoint authenticationEntryPoint() {&#10;        return (request, response, authException) -&gt; {&#10;            response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);&#10;            response.setContentType(&quot;application/json&quot;);&#10;            response.getWriter().write(&quot;{\&quot;error\&quot;:\&quot;Unauthorized\&quot;}&quot;);&#10;        };&#10;    }&#10;&#10;    @Bean&#10;    public AccessDeniedHandler accessDeniedHandler() {&#10;        return (request, response, accessDeniedException) -&gt; {&#10;            response.setStatus(HttpServletResponse.SC_FORBIDDEN);&#10;            response.setContentType(&quot;application/json&quot;);&#10;            response.getWriter().write(&quot;{\&quot;error\&quot;:\&quot;Forbidden\&quot;}&quot;);&#10;        };&#10;    }&#10;&#10;    @Bean&#10;    public SecurityFilterChain securityFilterChain(HttpSecurity http, JwtAuthFilter jwtAuthFilter) throws Exception {&#10;        http&#10;                .cors()&#10;                .and()&#10;                .csrf().disable()&#10;                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)&#10;                .and()&#10;                .exceptionHandling().authenticationEntryPoint(authenticationEntryPoint()).accessDeniedHandler(accessDeniedHandler())&#10;                .and()&#10;                .authorizeHttpRequests(authorize -&gt; authorize&#10;                        .requestMatchers(&quot;/auth/**&quot;).permitAll()&#10;                        .requestMatchers(HttpMethod.GET, &quot;/api/produto&quot;).hasAnyRole(&quot;USER&quot;,&quot;ADMIN&quot;)&#10;                        .requestMatchers(HttpMethod.POST, &quot;/api/produto&quot;).hasRole(&quot;ADMIN&quot;)&#10;                        .requestMatchers(HttpMethod.DELETE, &quot;/api/produto/**&quot;).hasRole(&quot;ADMIN&quot;)&#10;                        .requestMatchers(HttpMethod.GET, &quot;/api/categoria&quot;).hasAnyRole(&quot;USER&quot;,&quot;ADMIN&quot;)&#10;                        .requestMatchers(&quot;/admin/**&quot;).hasRole(&quot;ADMIN&quot;)&#10;                        .anyRequest().authenticated()&#10;                )&#10;                .addFilterBefore(jwtAuthFilter, UsernamePasswordAuthenticationFilter.class);&#10;        return http.build();&#10;    }&#10;&#10;    @Bean&#10;    public AuthenticationManager authenticationManager(HttpSecurity http, UserDetailsService uds, PasswordEncoder pe) throws Exception {&#10;        AuthenticationManagerBuilder auth = http.getSharedObject(AuthenticationManagerBuilder.class);&#10;        auth.userDetailsService(uds).passwordEncoder(pe);&#10;        return auth.build();&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>